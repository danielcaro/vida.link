<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui">
    <h:head>

        <script type="text/javascript"  src="js/socket.io-1.3.7.js"></script>
        <script type="text/javascript"  src="js/moment.js"></script>


        <title>Hello World</title>
        
        
        <style>
            #console { 
                height: 400px; 
                overflow: auto; 
            }
            .username-msg {color:orange;}
            .connect-msg {color:green;}
            .disconnect-msg {color:red;}
            .send-msg {color:#888}
        </style>




        <script type="text/javascript" >

            var userName = 'user' + Math.floor((Math.random() * 1000) + 1);

            var socket = io.connect('http://localhost:9090');

            socket.on('connect', function () {
                output('<span class="connect-msg">Client has connected to the server!</span>');
            });

            socket.on('vdlMsgData', function (msg) {
                data = JSON.parse(msg.data);
                //alert(JSON.stringify(msg));
                output('<span class="username-msg">' + data.userName + ':</span> ' + data.message);
            });

            socket.on('disconnect', function () {
                output('<span class="disconnect-msg">The client has disconnected!</span>');
            });

            function sendDisconnect() {
                socket.disconnect();
            }

            function sendMessage() {
                var message = $('#msg').val();
                $('#msg').val('');

                var jsonObject = {time: moment().format(), data: {userName: userName, message: message}};
                socket.emit('vdlMsgData', jsonObject);
            }

            function output(message) {
                var currentTime = '<span class="time">' + moment().format('HH:mm:ss.SSS') + '</span>';
                var element = $("<div>" + currentTime + " " + message + "</div>");
                $('#console').prepend(element);
            }

        </script>
    </h:head>


    <h:body id='body' >
        <b:container>
            <h1>Netty-socketio Demo Chat</h1>
            <br/>


            <b:well id="console"></b:well>


            <h:form onsubmit="return false;">
                <p:inputText id="msg" styleClass="input-xlarge" placeholder="Type something..."/>
                <p:commandButton type="button"  value="Send" onclick="sendMessage()" />
                <p:commandButton type="button"  value="Disconnect" onclick="sendDisconnect()" />
            </h:form>

        </b:container>

    </h:body>
</html>


